<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dynamic Tournament Bracket</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f0f0f0;
      padding: 20px;
      margin: 0;
    }

    h1 {
      text-align: center;
    }

    .controls {
      text-align: center;
      margin: 20px 0;
    }

    select, button {
      font-size: 16px;
      padding: 8px 16px;
      margin: 0 10px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    #bracket-container {
      display: flex;
      position: relative;
      justify-content: center;
      overflow-x: auto;
    }

    .round {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 20px;
    }

    .match {
      position: relative;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      margin: 30px 0;
      padding: 6px 12px;
      min-width: 140px;
      text-align: center;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .team {
      cursor: pointer;
      padding: 4px;
      border-radius: 4px;
    }

    .team:hover {
      background: #eee;
    }

    .winner {
      background-color: #c6efce !important;
      font-weight: bold;
    }

    .champion {
      background-color: gold !important;
      font-weight: bold;
      color: black;
    }

    svg.connector {
      position: absolute;
      top: 0;
      left: 0;
      overflow: visible;
      pointer-events: none;
    }
  </style>
</head>
<body>

<h1>üèÜ Dynamic Tournament Bracket</h1>

<div class="controls">
  <label for="playerCount">Number of Players:</label>
  <select id="playerCount">
    <option value="8">8 Players</option>
    <option value="16" selected>16 Players</option>
    <option value="32">32 Players</option>
    <option value="64">64 Players</option>
  </select>
  <button onclick="generateBracket()">Generate Bracket</button>
</div>

<div id="bracket-container"></div>

<script>
let rounds = [];

function generateBracket() {
  const count = parseInt(document.getElementById("playerCount").value);
  const teamCount = count / 2;

  // Generate teams
  const teams = [];
  for (let i = 0; i < teamCount; i++) {
    teams.push(`Team ${String.fromCharCode(65 + i)}`);
  }

  createBracket(teams);
}

function createBracket(teams) {
  const r1 = [];
  for (let i = 0; i < teams.length; i += 2) {
    r1.push([teams[i], teams[i + 1]]);
  }
  rounds = [r1];

  let numMatches = r1.length / 2;
  while (numMatches >= 1) {
    rounds.push(new Array(numMatches).fill([null, null]));
    numMatches /= 2;
  }

  drawBracket();
}

function drawBracket() {
  const container = document.getElementById("bracket-container");
  container.innerHTML = "";
  const matchRefs = [];

  rounds.forEach((round, rIdx) => {
    const roundDiv = document.createElement("div");
    roundDiv.className = "round";

    matchRefs[rIdx] = [];

    round.forEach((match, mIdx) => {
      const matchDiv = document.createElement("div");
      matchDiv.className = "match";

      match.forEach((team, tIdx) => {
        const teamDiv = document.createElement("div");
        teamDiv.className = "team";
        teamDiv.innerHTML = team ? team : "<em>?</em>";
        if (team) {
          teamDiv.onclick = () => handleWinner(rIdx, mIdx, tIdx);
        }
        matchDiv.appendChild(teamDiv);
      });

      roundDiv.appendChild(matchDiv);
      matchRefs[rIdx].push(matchDiv);
    });

    container.appendChild(roundDiv);
  });

  drawLines(matchRefs);
}

function drawLines(matchRefs) {
  document.querySelectorAll("svg.connector").forEach(el => el.remove());

  for (let r = 0; r < matchRefs.length - 1; r++) {
    const current = matchRefs[r];
    const next = matchRefs[r + 1];

    for (let i = 0; i < next.length; i++) {
      const left = current[i * 2];
      const right = current[i * 2 + 1];
      const dest = next[i];

      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.classList.add("connector");

      const lRect = left.getBoundingClientRect();
      const rRect = right.getBoundingClientRect();
      const dRect = dest.getBoundingClientRect();
      const cRect = document.getElementById("bracket-container").getBoundingClientRect();

      const x1 = lRect.right - cRect.left;
      const y1 = (lRect.top + lRect.bottom) / 2 - cRect.top;

      const x2 = rRect.right - cRect.left;
      const y2 = (rRect.top + rRect.bottom) / 2 - cRect.top;

      const x3 = dRect.left - cRect.left;
      const y3 = (dRect.top + dRect.bottom) / 2 - cRect.top;

      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", `
        M ${x1} ${y1} 
        L ${x1 + 10} ${y1}
        L ${x1 + 10} ${y3}
        L ${x3} ${y3}
        M ${x2} ${y2} 
        L ${x2 + 10} ${y2}
        L ${x2 + 10} ${y3}
      `);
      path.setAttribute("stroke", "#aaa");
      path.setAttribute("stroke-width", "2");
      path.setAttribute("fill", "none");

      svg.appendChild(path);
      svg.style.position = "absolute";
      svg.style.top = "0";
      svg.style.left = "0";
      svg.style.width = "100%";
      svg.style.height = "100%";
      svg.style.overflow = "visible";
      document.getElementById("bracket-container").appendChild(svg);
    }
  }
}

function handleWinner(roundIndex, matchIndex, teamIndex) {
  const winner = rounds[roundIndex][matchIndex][teamIndex];
  if (!winner) return;

  const matchEl = document.querySelectorAll(".round")[roundIndex].children[matchIndex];
  [...matchEl.children].forEach(el => {
    el.classList.remove("winner", "champion");
    if (el.textContent === winner) {
      el.classList.add(roundIndex === rounds.length - 1 ? "champion" : "winner");
    }
  });

  if (roundIndex + 1 < rounds.length) {
    const nextMatchIndex = Math.floor(matchIndex / 2);
    const position = matchIndex % 2;
    const next = [...rounds[roundIndex + 1][nextMatchIndex]];
    next[position] = winner;
    rounds[roundIndex + 1][nextMatchIndex] = next;
    drawBracket();
  }
}

// Generate default bracket
generateBracket();
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Tournament Bracket</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 2rem;
      background: #f7f9fc;
    }

    h1 {
      text-align: center;
      margin-bottom: 1rem;
    }

    textarea {
      width: 100%;
      height: 150px;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 1rem;
    }

    button {
      display: block;
      margin: 0 auto 2rem auto;
      padding: 10px 20px;
      font-size: 1rem;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    #bracket-wrapper {
      display: flex;
      justify-content: center;
      gap: 50px;
      flex-wrap: wrap;
    }

    .bracket-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      position: relative;
      min-width: 300px;
    }

    .round {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 20px;
    }

    .match {
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 8px;
      margin: 10px 0;
      padding: 10px;
      width: 200px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }

    .team {
      padding: 5px;
      cursor: pointer;
      transition: background-color 0.3s;
    }

    .team:hover {
      background-color: #f1f1f1;
    }

    .winner {
      background-color: #d1e7dd;
      font-weight: bold;
    }

    .champion {
      background-color: gold;
      font-weight: bold;
    }

    .center-round {
      margin-top: 20px;
      margin-bottom: 20px;
    }

    .final-label {
      font-weight: bold;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>Create Tournament Bracket</h1>
  <textarea id="players" placeholder="Enter one player name per line"></textarea>
  <button onclick="generateBracket()">Generate Bracket</button>

  <div id="bracket-wrapper">
    <div id="left-bracket" class="bracket-container"></div>
    <div id="center-final" class="bracket-container"></div>
    <div id="right-bracket" class="bracket-container"></div>
  </div>

  <script>
    let leftRounds = [], rightRounds = [], finalMatch = [];

    function generateBracket() {
      const input = document.getElementById("players").value.trim();
      const names = input.split("\n").map(n => n.trim()).filter(Boolean);

      if (names.length < 2) {
        alert("Enter at least 2 player names.");
        return;
      }

      const shuffled = names.sort(() => 0.5 - Math.random());
      const teams = [];
      for (let i = 0; i < shuffled.length;) {
        const teamSize = (shuffled.length - i > 3) ? 2 : (shuffled.length - i);
        teams.push("Team " + shuffled.slice(i, i + teamSize).join(" & "));
        i += teamSize;
      }

      const half = Math.ceil(teams.length / 2);
      const leftTeams = teams.slice(0, half);
      const rightTeams = teams.slice(half);

      leftRounds = buildRounds(leftTeams);
      rightRounds = buildRounds(rightTeams);
      finalMatch = [[null, null]];

      drawFullBracket();
    }

    function buildRounds(teams) {
      const firstRound = [];
      for (let i = 0; i < teams.length; i += 2) {
        firstRound.push([teams[i], teams[i + 1] || null]);
      }

      const rounds = [firstRound];
      let count = firstRound.length;

      while (count > 1) {
        const nextRound = new Array(Math.ceil(count / 2)).fill([null, null]);
        rounds.push(nextRound);
        count = nextRound.length;
      }

      return rounds;
    }

    function drawFullBracket() {
      document.getElementById("left-bracket").innerHTML = "";
      document.getElementById("right-bracket").innerHTML = "";
      document.getElementById("center-final").innerHTML = "";

      drawBracket("left-bracket", leftRounds, "left");
      drawBracket("right-bracket", rightRounds, "right");
      drawFinalMatch();
    }

    function drawBracket(containerId, rounds, side) {
      const container = document.getElementById(containerId);
      rounds.forEach((round, rIdx) => {
        const roundDiv = document.createElement("div");
        roundDiv.className = "round";

        round.forEach((match, mIdx) => {
          const matchDiv = document.createElement("div");
          matchDiv.className = "match";

          match.forEach((team, tIdx) => {
            const teamDiv = document.createElement("div");
            teamDiv.className = "team";
            teamDiv.innerHTML = team || "<em>?</em>";

            if (team) {
              teamDiv.onclick = () => {
                rounds[rIdx][mIdx].winner = tIdx;
                updateNextRound(rounds, rIdx, mIdx, team, side);
                drawFullBracket();
              };
            }

            if (rounds[rIdx][mIdx].winner === tIdx) {
              teamDiv.classList.add(rIdx === rounds.length - 1 ? "champion" : "winner");
            }

            matchDiv.appendChild(teamDiv);
          });

          roundDiv.appendChild(matchDiv);
        });

        container.appendChild(roundDiv);
      });
    }

    function updateNextRound(rounds, roundIndex, matchIndex, winner, side) {
      if (roundIndex + 1 >= rounds.length) {
        // Send winner to final
        const finalIdx = (side === "left") ? 0 : 1;
        finalMatch[0][finalIdx] = winner;
      } else {
        const nextMatchIndex = Math.floor(matchIndex / 2);
        const pos = matchIndex % 2;
        const nextMatch = [...rounds[roundIndex + 1][nextMatchIndex]];
        nextMatch[pos] = winner;
        rounds[roundIndex + 1][nextMatchIndex] = nextMatch;
      }
    }

    function drawFinalMatch() {
      const container = document.getElementById("center-final");

      const label = document.createElement("div");
      label.className = "final-label";
      label.textContent = "Final Match";
      container.appendChild(label);

      const roundDiv = document.createElement("div");
      roundDiv.className = "round center-round";

      const match = document.createElement("div");
      match.className = "match";

      finalMatch[0].forEach((team, tIdx) => {
        const teamDiv = document.createElement("div");
        teamDiv.className = "team";
        teamDiv.innerHTML = team || "<em>?</em>";

        if (team) {
          teamDiv.onclick = () => {
            finalMatch[0].winner = tIdx;
            drawFullBracket();
          };
        }

        if (finalMatch[0].winner === tIdx) {
          teamDiv.classList.add("champion");
        }

        match.appendChild(teamDiv);
      });

      roundDiv.appendChild(match);
      container.appendChild(roundDiv);
    }
  </script>
</body>
</html>
